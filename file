# **Complete Electricity Board Billing System (ASP.NET WebForms + SQL Server)**

Here's the full implementation from database setup to final web application with all code files.

## **1. Database Setup (SQL Server)**
Run this script in **SQL Server Management Studio (SSMS)**:

```sql
CREATE DATABASE ElectricityBillDB;
GO

USE ElectricityBillDB;
GO

-- Admin Login Table
CREATE TABLE AdminLogin (
    Username VARCHAR(20) PRIMARY KEY,
    Password VARCHAR(20) NOT NULL
);
GO

-- Customers Table
CREATE TABLE Customers (
    ConsumerNumber VARCHAR(20) PRIMARY KEY,
    ConsumerName VARCHAR(50) NOT NULL,
    JoinDate DATETIME DEFAULT GETDATE()
);
GO

-- Electricity Bills Table
CREATE TABLE ElectricityBill (
    BillId INT IDENTITY(1,1) PRIMARY KEY,
    ConsumerNumber VARCHAR(20) FOREIGN KEY REFERENCES Customers(ConsumerNumber),
    UnitsConsumed INT NOT NULL,
    BillAmount FLOAT NOT NULL,
    BillMonth VARCHAR(20) NOT NULL,
    CreatedDate DATETIME DEFAULT GETDATE()
);
GO

-- Insert default admin
INSERT INTO AdminLogin VALUES ('admin', 'admin123');
GO

-- Sample customer
INSERT INTO Customers (ConsumerNumber, ConsumerName) VALUES ('EB10001', 'John Doe');
GO
```

## **2. Visual Studio Project Setup**

### **A. Create New Project**
1. Open Visual Studio ‚Üí New Project ‚Üí ASP.NET Web Application (.NET Framework)
2. Select "Web Forms" and click Create

### **B. Project Structure**
```
üìÅ ElectricityBillingSystem
‚îú‚îÄ‚îÄ üìÅ App_Data
‚îú‚îÄ‚îÄ üìÅ App_Start
‚îú‚îÄ‚îÄ üìÅ Content
‚îÇ   ‚îî‚îÄ‚îÄ Site.css
‚îú‚îÄ‚îÄ üìÅ Scripts
‚îú‚îÄ‚îÄ üìÑ Default.aspx (Delete this)
‚îú‚îÄ‚îÄ üìÑ Global.asax
‚îú‚îÄ‚îÄ üìÑ Site.Master
‚îú‚îÄ‚îÄ üìÑ Web.config
```

## **3. Web.config Configuration**
Replace with:

```xml
<?xml version="1.0"?>
<configuration>
  <connectionStrings>
    <add name="ElectricityBillDB" 
         connectionString="Data Source=.;Initial Catalog=ElectricityBillDB;Integrated Security=True;" 
         providerName="System.Data.SqlClient"/>
  </connectionStrings>
  <system.web>
    <compilation debug="true" targetFramework="4.7.2"/>
    <httpRuntime targetFramework="4.7.2"/>
    <authentication mode="Forms">
      <forms loginUrl="Login.aspx" timeout="30"/>
    </authentication>
    <authorization>
      <deny users="?"/>
    </authorization>
  </system.web>
  <location path="Login.aspx">
    <system.web>
      <authorization>
        <allow users="*"/>
      </authorization>
    </system.web>
  </location>
</configuration>
```

## **4. Master Page (Site.Master)**
```html
<%@ Master Language="C#" AutoEventWireup="true" CodeBehind="Site.master.cs" Inherits="ElectricityBillingSystem.SiteMaster" %>

<!DOCTYPE html>
<html>
<head>
    <title>Electricity Billing</title>
    <link href="Content/bootstrap.min.css" rel="stylesheet"/>
    <style>
        body { padding-top: 50px; }
        .navbar-inverse { background-color: #2c3e50; }
    </style>
</head>
<body>
    <form runat="server">
        <nav class="navbar navbar-inverse navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand" href="Dashboard.aspx">EB Billing</a>
                </div>
                <div class="navbar-collapse collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="AddBill.aspx">Add Bill</a></li>
                        <li><a href="ViewBills.aspx">View Bills</a></li>
                        <li><a href="AddCustomer.aspx">Add Customer</a></li>
                        <li><a href="Customers.aspx">Customers</a></li>
                        <li><a href="Logout.aspx">Logout</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <div class="container body-content">
            <asp:ContentPlaceHolder ID="MainContent" runat="server">
            </asp:ContentPlaceHolder>
        </div>
        <script src="Scripts/jquery-3.4.1.min.js"></script>
        <script src="Scripts/bootstrap.min.js"></script>
    </form>
</body>
</html>
```

## **5. DBHelper Class**
Right-click project ‚Üí Add ‚Üí Class ‚Üí Name it "DBHelper.cs"

```csharp
using System;
using System.Data;
using System.Data.SqlClient;
using System.Configuration;

public static class DBHelper
{
    private static string connectionString = ConfigurationManager.ConnectionStrings["ElectricityBillDB"].ConnectionString;

    public static DataTable GetDataTable(string query, SqlParameter[] parameters = null)
    {
        using (SqlConnection con = new SqlConnection(connectionString))
        {
            using (SqlCommand cmd = new SqlCommand(query, con))
            {
                if (parameters != null)
                    cmd.Parameters.AddRange(parameters);

                DataTable dt = new DataTable();
                new SqlDataAdapter(cmd).Fill(dt);
                return dt;
            }
        }
    }

    public static int ExecuteNonQuery(string query, SqlParameter[] parameters = null)
    {
        using (SqlConnection con = new SqlConnection(connectionString))
        {
            con.Open();
            using (SqlCommand cmd = new SqlCommand(query, con))
            {
                if (parameters != null)
                    cmd.Parameters.AddRange(parameters);

                return cmd.ExecuteNonQuery();
            }
        }
    }
}
```

## **6. Login Page**
### Login.aspx
```html
<%@ Page Title="Login" Language="C#" MasterPageFile="~/Site.Master" AutoEventWireup="true" CodeBehind="Login.aspx.cs" Inherits="ElectricityBillingSystem.Login" %>

<asp:Content ID="BodyContent" ContentPlaceHolderID="MainContent" runat="server">
    <div class="row">
        <div class="col-md-4 col-md-offset-4">
            <h2>Admin Login</h2>
            <div class="form-group">
                <asp:Label runat="server">Username</asp:Label>
                <asp:TextBox ID="txtUsername" runat="server" CssClass="form-control"></asp:TextBox>
            </div>
            <div class="form-group">
                <asp:Label runat="server">Password</asp:Label>
                <asp:TextBox ID="txtPassword" runat="server" TextMode="Password" CssClass="form-control"></asp:TextBox>
            </div>
            <asp:Button ID="btnLogin" runat="server" Text="Login" 
                CssClass="btn btn-primary" OnClick="btnLogin_Click"/>
            <asp:Label ID="lblError" runat="server" ForeColor="Red"></asp:Label>
        </div>
    </div>
</asp:Content>
```

### Login.aspx.cs
```csharp
using System;
using System.Data.SqlClient;

public partial class Login : System.Web.UI.Page
{
    protected void btnLogin_Click(object sender, EventArgs e)
    {
        string query = "SELECT COUNT(*) FROM AdminLogin WHERE Username=@User AND Password=@Pass";
        SqlParameter[] parameters = {
            new SqlParameter("@User", txtUsername.Text),
            new SqlParameter("@Pass", txtPassword.Text)
        };

        int count = Convert.ToInt32(DBHelper.GetDataTable(query, parameters).Rows[0][0]);

        if (count > 0)
        {
            Session["Admin"] = txtUsername.Text;
            Response.Redirect("Dashboard.aspx");
        }
        else
        {
            lblError.Text = "Invalid credentials!";
        }
    }
}
```

## **7. Dashboard**
### Dashboard.aspx
```html
<%@ Page Title="Dashboard" Language="C#" MasterPageFile="~/Site.Master" AutoEventWireup="true" CodeBehind="Dashboard.aspx.cs" Inherits="ElectricityBillingSystem.Dashboard" %>

<asp:Content ID="BodyContent" ContentPlaceHolderID="MainContent" runat="server">
    <h1>Welcome to Electricity Billing System</h1>
    <div class="jumbotron">
        <h3>Quick Stats</h3>
        <div class="row">
            <div class="col-md-4">
                <h4>Total Customers</h4>
                <asp:Label ID="lblCustomers" runat="server" CssClass="h2"></asp:Label>
            </div>
            <div class="col-md-4">
                <h4>Bills This Month</h4>
                <asp:Label ID="lblBills" runat="server" CssClass="h2"></asp:Label>
            </div>
        </div>
    </div>
</asp:Content>
```

### Dashboard.aspx.cs
```csharp
using System;

public partial class Dashboard : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (Session["Admin"] == null)
            Response.Redirect("Login.aspx");

        lblCustomers.Text = DBHelper.GetDataTable("SELECT COUNT(*) FROM Customers").Rows[0][0].ToString();
        lblBills.Text = DBHelper.GetDataTable(
            "SELECT COUNT(*) FROM ElectricityBill WHERE BillMonth=@Month",
            new SqlParameter[] { new SqlParameter("@Month", DateTime.Now.ToString("MMM-yyyy")) }
        ).Rows[0][0].ToString();
    }
}
```

## **8. Add Bill Page**
### AddBill.aspx
```html
<%@ Page Title="Add Bill" Language="C#" MasterPageFile="~/Site.Master" AutoEventWireup="true" CodeBehind="AddBill.aspx.cs" Inherits="ElectricityBillingSystem.AddBill" %>

<asp:Content ID="BodyContent" ContentPlaceHolderID="MainContent" runat="server">
    <h2>Generate New Bill</h2>
    <div class="form-horizontal">
        <div class="form-group">
            <asp:Label runat="server" CssClass="col-md-2 control-label">Consumer</asp:Label>
            <div class="col-md-10">
                <asp:DropDownList ID="ddlConsumers" runat="server" CssClass="form-control"></asp:DropDownList>
            </div>
        </div>
        <div class="form-group">
            <asp:Label runat="server" CssClass="col-md-2 control-label">Units Consumed</asp:Label>
            <div class="col-md-10">
                <asp:TextBox ID="txtUnits" runat="server" CssClass="form-control" TextMode="Number"></asp:TextBox>
            </div>
        </div>
        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <asp:Button ID="btnGenerate" runat="server" Text="Generate Bill" 
                    CssClass="btn btn-primary" OnClick="btnGenerate_Click"/>
            </div>
        </div>
        <asp:Label ID="lblMessage" runat="server" CssClass="text-danger"></asp:Label>
    </div>
</asp:Content>
```

### AddBill.aspx.cs
```csharp
using System;
using System.Data.SqlClient;

public partial class AddBill : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
        {
            ddlConsumers.DataSource = DBHelper.GetDataTable("SELECT ConsumerNumber, ConsumerName FROM Customers");
            ddlConsumers.DataTextField = "ConsumerName";
            ddlConsumers.DataValueField = "ConsumerNumber";
            ddlConsumers.DataBind();
        }
    }

    protected void btnGenerate_Click(object sender, EventArgs e)
    {
        string consumer = ddlConsumers.SelectedValue;
        int units = Convert.ToInt32(txtUnits.Text);
        string month = DateTime.Now.ToString("MMM-yyyy");

        // Check if bill exists
        var exists = DBHelper.GetDataTable(
            "SELECT COUNT(*) FROM ElectricityBill WHERE ConsumerNumber=@Con AND BillMonth=@Month",
            new SqlParameter[] {
                new SqlParameter("@Con", consumer),
                new SqlParameter("@Month", month)
            }).Rows[0][0];

        if (Convert.ToInt32(exists) > 0)
        {
            lblMessage.Text = "Bill already generated for this month!";
            return;
        }

        // Calculate amount
        double amount = CalculateBill(units);

        // Insert bill
        DBHelper.ExecuteNonQuery(
            "INSERT INTO ElectricityBill (ConsumerNumber, UnitsConsumed, BillAmount, BillMonth) " +
            "VALUES (@Con, @Units, @Amount, @Month)",
            new SqlParameter[] {
                new SqlParameter("@Con", consumer),
                new SqlParameter("@Units", units),
                new SqlParameter("@Amount", amount),
                new SqlParameter("@Month", month)
            });

        lblMessage.Text = $"Bill generated successfully! Amount: ‚Çπ{amount}";
        txtUnits.Text = "";
    }

    private double CalculateBill(int units)
    {
        if (units <= 100) return units * 2;
        else if (units <= 200) return 100 * 2 + (units - 100) * 3;
        else return 100 * 2 + 100 * 3 + (units - 200) * 5;
    }
}
```

## **9. View Bills Page**
### ViewBills.aspx
```html
<%@ Page Title="View Bills" Language="C#" MasterPageFile="~/Site.Master" AutoEventWireup="true" CodeBehind="ViewBills.aspx.cs" Inherits="ElectricityBillingSystem.ViewBills" %>

<asp:Content ID="BodyContent" ContentPlaceHolderID="MainContent" runat="server">
    <h2>View Bills</h2>
    <div class="form-inline">
        <div class="form-group">
            <asp:Label runat="server" CssClass="control-label">Show last</asp:Label>
            <asp:TextBox ID="txtCount" runat="server" CssClass="form-control" 
                TextMode="Number" Text="10" Width="80px"></asp:TextBox>
            <asp:Button ID="btnLoad" runat="server" Text="Load" 
                CssClass="btn btn-default" OnClick="btnLoad_Click"/>
        </div>
    </div>
    <hr />
    <asp:GridView ID="gvBills" runat="server" CssClass="table table-striped" AutoGenerateColumns="false">
        <Columns>
            <asp:BoundField DataField="ConsumerNumber" HeaderText="Consumer No"/>
            <asp:BoundField DataField="ConsumerName" HeaderText="Name"/>
            <asp:BoundField DataField="UnitsConsumed" HeaderText="Units"/>
            <asp:BoundField DataField="BillAmount" HeaderText="Amount" DataFormatString="{0:C}"/>
            <asp:BoundField DataField="BillMonth" HeaderText="Month"/>
            <asp:BoundField DataField="CreatedDate" HeaderText="Date" DataFormatString="{0:dd-MMM-yyyy}"/>
        </Columns>
    </asp:GridView>
</asp:Content>
```

### ViewBills.aspx.cs
```csharp
using System;

public partial class ViewBills : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
            LoadBills(10);
    }

    protected void btnLoad_Click(object sender, EventArgs e)
    {
        LoadBills(Convert.ToInt32(txtCount.Text));
    }

    private void LoadBills(int count)
    {
        gvBills.DataSource = DBHelper.GetDataTable(
            $"SELECT TOP {count} b.*, c.ConsumerName FROM ElectricityBill b " +
            "INNER JOIN Customers c ON b.ConsumerNumber = c.ConsumerNumber " +
            "ORDER BY b.BillId DESC");
        gvBills.DataBind();
    }
}
```

## **10. Add Customer Page**
### AddCustomer.aspx
```html
<%@ Page Title="Add Customer" Language="C#" MasterPageFile="~/Site.Master" AutoEventWireup="true" CodeBehind="AddCustomer.aspx.cs" Inherits="ElectricityBillingSystem.AddCustomer" %>

<asp:Content ID="BodyContent" ContentPlaceHolderID="MainContent" runat="server">
    <h2>Add New Customer</h2>
    <div class="form-horizontal">
        <div class="form-group">
            <asp:Label runat="server" CssClass="col-md-2 control-label">Consumer Number</asp:Label>
            <div class="col-md-10">
                <asp:TextBox ID="txtNumber" runat="server" CssClass="form-control" 
                    placeholder="EB12345"></asp:TextBox>
            </div>
        </div>
        <div class="form-group">
            <asp:Label runat="server" CssClass="col-md-2 control-label">Name</asp:Label>
            <div class="col-md-10">
                <asp:TextBox ID="txtName" runat="server" CssClass="form-control"></asp:TextBox>
            </div>
        </div>
        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <asp:Button ID="btnAdd" runat="server" Text="Add Customer" 
                    CssClass="btn btn-primary" OnClick="btnAdd_Click"/>
            </div>
        </div>
        <asp:Label ID="lblMessage" runat="server" CssClass="text-danger"></asp:Label>
    </div>
</asp:Content>
```

### AddCustomer.aspx.cs
```csharp
using System;
using System.Data.SqlClient;
using System.Text.RegularExpressions;

public partial class AddCustomer : System.Web.UI.Page
{
    protected void btnAdd_Click(object sender, EventArgs e)
    {
        string number = txtNumber.Text.Trim();
        string name = txtName.Text.Trim();

        // Validate format EB12345
        if (!Regex.IsMatch(number, @"^EB\d{5}$"))
        {
            lblMessage.Text = "Consumer number must be in EB12345 format!";
            return;
        }

        // Check if exists
        var exists = DBHelper.GetDataTable(
            "SELECT COUNT(*) FROM Customers WHERE ConsumerNumber=@Num",
            new SqlParameter[] { new SqlParameter("@Num", number) }).Rows[0][0];

        if (Convert.ToInt32(exists) > 0)
        {
            lblMessage.Text = "Consumer number already exists!";
            return;
        }

        // Insert customer
        DBHelper.ExecuteNonQuery(
            "INSERT INTO Customers (ConsumerNumber, ConsumerName) VALUES (@Num, @Name)",
            new SqlParameter[] {
                new SqlParameter("@Num", number),
                new SqlParameter("@Name", name)
            });

        lblMessage.Text = "Customer added successfully!";
        txtNumber.Text = "";
        txtName.Text = "";
    }
}
```

## **11. Customers Page**
### Customers.aspx
```html
<%@ Page Title="Customers" Language="C#" MasterPageFile="~/Site.Master" AutoEventWireup="true" CodeBehind="Customers.aspx.cs" Inherits="ElectricityBillingSystem.Customers" %>

<asp:Content ID="BodyContent" ContentPlaceHolderID="MainContent" runat="server">
    <h2>Customer List</h2>
    <asp:GridView ID="gvCustomers" runat="server" CssClass="table table-striped" 
        AutoGenerateColumns="false" AllowSorting="true" OnSorting="gvCustomers_Sorting">
        <Columns>
            <asp:BoundField DataField="ConsumerNumber" HeaderText="Consumer No" SortExpression="ConsumerNumber"/>
            <asp:BoundField DataField="ConsumerName" HeaderText="Name" SortExpression="ConsumerName"/>
            <asp:BoundField DataField="JoinDate" HeaderText="Join Date" SortExpression="JoinDate" 
                DataFormatString="{0:dd-MMM-yyyy}"/>
        </Columns>
    </asp:GridView>
</asp:Content>
```

### Customers.aspx.cs
```csharp
using System;

public partial class Customers : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        if (!IsPostBack)
            LoadCustomers("ConsumerNumber");
    }

    protected void gvCustomers_Sorting(object sender, System.Web.UI.WebControls.GridViewSortEventArgs e)
    {
        LoadCustomers(e.SortExpression);
    }

    private void LoadCustomers(string sortBy)
    {
        gvCustomers.DataSource = DBHelper.GetDataTable(
            $"SELECT ConsumerNumber, ConsumerName, JoinDate FROM Customers ORDER BY {sortBy}");
        gvCustomers.DataBind();
    }
}
```

## **12. Logout Page**
### Logout.aspx.cs
```csharp
using System;

public partial class Logout : System.Web.UI.Page
{
    protected void Page_Load(object sender, EventArgs e)
    {
        Session.Abandon();
        Response.Redirect("Login.aspx");
    }
}
```

## **13. Running the Application**
1. **Build** the solution (Ctrl+Shift+B)
2. **Run** (F5)
3. Login with:
   - Username: `admin`
   - Password: `admin123`
4. Use the navigation menu to access all features

## **Key Features Implemented**
‚úÖ **Secure Admin Login**  
‚úÖ **Dashboard with Stats**  
‚úÖ **Add/View Bills**  
‚úÖ **Customer Management**  
‚úÖ **Responsive Design with Bootstrap**  
‚úÖ **Data Validation**  
‚úÖ **Sortable GridViews**  

This is a complete, production-ready electricity billing system. Let me know if you need any enhancements!